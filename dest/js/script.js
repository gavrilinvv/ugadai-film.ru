"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function asyncGeneratorStep(e,n,t,r,o,a,c){try{var u=e[a](c),i=u.value}catch(e){return void t(e)}u.done?n(i):Promise.resolve(i).then(r,o)}function _asyncToGenerator(u){return function(){var e=this,c=arguments;return new Promise(function(n,t){var r=u.apply(e,c);function o(e){asyncGeneratorStep(r,n,t,o,a,"next",e)}function a(e){asyncGeneratorStep(r,n,t,o,a,"throw",e)}o(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var n=document.querySelector(".menu"),t=document.querySelector(".menu__shot"),r=document.querySelector(".options"),o=document.querySelector(".playground"),a=document.querySelector(".losing"),c=document.querySelector(".winning"),u=document.querySelectorAll(".options .genre .checkbox__body"),i=document.querySelectorAll(".options .option .checkbox__body"),s=document.querySelector(".playground-timer"),l=document.querySelector(".playground-score span"),d=document.querySelector(".playground-img"),y=document.querySelector(".playground-img__container"),f=document.querySelector(".playground-fact"),m=document.querySelector(".playground-fact__text"),p=document.querySelector(".playground-quest"),h=document.querySelectorAll(".js-to-options"),_=document.querySelectorAll(".js-to-game"),g=document.querySelectorAll(".js-next-question"),b=document.querySelector(".count-films span"),v=document.querySelector(".playground-answers"),L=(new cloudinary.Cloudinary({cloud_name:"ddu8qv5kp",secure:!0}),[]),k=[],S=null,T=[],A={needTimer:!1,onelife:!1,facts:!1},q=10,M=null;function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getJSON("/dest/json/films.json?"+(new Date).getMilliseconds(),function(e){return e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function w(e,n){var t=e.querySelector("input"),r=t.value;t.checked=!t.checked,e.classList[t.checked?"add":"remove"]("checkbox__checked"),n&&(n=n.querySelector("input"),t.checked=n.checked,e.classList[n.checked?"add":"remove"]("checkbox__checked")),!L.includes(r)&&t.checked?L.push(r):L.forEach(function(e,n){e===r&&L.splice(n,1)})}function E(e){[n,r,o,a,c].forEach(function(e){e.style.display="none"}),e.style.display="block"}function H(e,n){var t,r,o=e;_toConsumableArray(document.querySelectorAll(".button__answer")).forEach(function(e){e.style.pointerEvents="none"}),k.push(S),o==S?(l.classList.add("active"),setTimeout(function(){l.classList.remove("active")},300),l.innerHTML=++l.innerHTML,n.classList.add("button__answer-success"),r=e,t=T.find(function(e){if(+r===e.id)return e}),A.needTimer&&(s.style.opacity="0",s.style.animationName="none",clearInterval(M)),setTimeout(function(){t.facts&&A.facts?(m.innerHTML=t.facts[0],f.style.display="block",p.style.display="none"):x()},800)):(n.classList.add("button__answer-error"),setTimeout(function(){v.innerHTML="",A.onelife?(l.innerHTML=0,k=[],E(a)):x()},800))}function x(){v.innerHTML="",m.innerHTML="",p.style.display="block",f.style.display="none",function(){return C.apply(this,arguments)}().then(function(e){y.classList.remove("playground-img__container-load"),A.needTimer&&(clearInterval(M),s.style.opacity="1",s.style.display="block",s.style.animationName="none",setTimeout(function(){s.style.animationName=""},10),s.style.animationDuration=q+"s",M=setTimeout(function(){clearInterval(M),v.innerHTML="",k=[],E(a)},1e3*q)),d.src=e.photo,d.classList.remove("_noopacity"),S=e.answer,e.answers.forEach(function(e){var n=document.createElement("div");n.classList.add("button"),n.innerHTML=e.name+" <span>("+e.year+")</span>",n.setAttribute("data-value",e.id),n.classList.add("button__answer"),25<e.name.length+e.year.length&&n.classList.add("button__small"),v.appendChild(n),n.addEventListener("mousedown",function(){n.style.transform="scale(0.9)"}),n.addEventListener("mouseout",function(){n.style.transform="scale(1)"}),n.addEventListener("mouseup",function(){H(n.getAttribute("data-value"),n)})})})}function j(e,n){return e.map(function(e){return n.includes(e)}).includes(!0)}function C(){return(C=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,t,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=T.filter(function(e){return 0!==e.genres.filter(function(e){return L.includes(e)}).length}),t={},r=[],k.length===n.length)return v.innerHTML="",k=[],E(c),e.abrupt("return");e.next=8;break;case 8:for(;r.length<1;)t=T[I(T.length)],j(t.genres,L)&&!1===k.includes(t.id)&&r.push(t);for(;r.length<4;)o=T[I(T.length)],a=o.genres,!r.includes(o)&&o!==t&&j(a,t.genres)&&r.push(o);return r=function(e){var n,t,r=e.length;for(;0!==r;)t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n;return e}(r=r.map(function(e){return{id:e.id,name:e.name,year:e.year}})),d.classList.add("_noopacity"),d.src="",y.classList.add("playground-img__container-load"),e.abrupt("return",fetch("https://res.cloudinary.com/ddu8qv5kp/image/upload/v1634839395/"+t.id+".jpg").then(function(e){return e.blob()}).then(function(e){return{photo:URL.createObjectURL(e),answer:t.id,answers:r}}));case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}function I(e){return Math.floor(Math.random()*e)}!function(){return e.apply(this,arguments)}().then(function(e){var n;T=e,b.innerHTML=T.length,t.style.backgroundImage='url("/src/img/film'+(n=1,e=3,Math.floor(Math.random()*(e-n+1)+n))+'.jpg")',_toConsumableArray(h).map(function(e){e.addEventListener("click",function(){E(r)})}),_toConsumableArray(_).map(function(e){e.addEventListener("click",function(){L.length?(E(o),l.innerHTML=0,v.innerHTML="",m.innerHTML="",p.style.display="block",f.style.display="none",x()):alert("Выберите категорию")})}),_toConsumableArray(g).map(function(e){e.addEventListener("click",function(){x()})}),_toConsumableArray(u).forEach(function(n){n.addEventListener("click",function(){n.querySelector("input").getAttribute("data-is-parent")?n.parentElement.querySelectorAll(".checkbox__body").forEach(function(e){w(e,n)}):w(n)})}),_toConsumableArray(i).forEach(function(t){t.addEventListener("click",function(){var e=t.querySelector("input"),n=e.value;e.checked=!e.checked,t.classList[e.checked?"add":"remove"]("checkbox__checked"),"time"==n&&(A.needTimer=e.checked),"onelife"==n&&(A.onelife=e.checked),"facts"==n&&(A.facts=e.checked)})})})});