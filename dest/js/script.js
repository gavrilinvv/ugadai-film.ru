"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_getRequireWildcardCache=function(e){return e?n:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,r,a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(a,n,r):a[n]=e[n]);return a.default=e,t&&t.set(e,a),a}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);c=!0);}catch(e){i=!0,a=e}finally{try{c||null==n.return||n.return()}finally{if(i)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,a,o,c){try{var i=e[o](c),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,n){var r=i.apply(e,c);function a(e){asyncGeneratorStep(r,t,n,a,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,a,o,"throw",e)}a(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".menu"),n=(document.querySelector(".menu__shot"),document.querySelector(".options-category")),a=document.querySelector(".options-params"),r=document.querySelector(".about"),l=document.querySelector(".playground"),o=document.querySelector(".other-games"),c=document.querySelector(".losing"),u=document.querySelector(".winning"),s=document.querySelector(".winning__answers-correct span"),d=document.querySelector(".winning__answers-incorrect span"),i=document.querySelectorAll(".options .genre .checkbox__body"),y=document.querySelectorAll(".options .option .checkbox__body"),f=document.querySelector(".options .option #inputTargetCount"),e=document.querySelector(".options .option #outputTargetCount"),m=document.querySelector("#years"),p=document.querySelectorAll(".js-close-modal"),v=document.querySelector(".modal#modalYears"),h=document.querySelector(".js-save-years"),b=document.querySelector("#modalYears .years-grid"),g=document.querySelector(".playground-timer"),_=document.querySelector(".playground-notice"),L=document.querySelector(".playground-score span"),S=document.querySelector(".playground-img"),w=document.querySelector(".playground-fact"),k=document.querySelector(".playground-fact__text"),q=document.querySelector(".playground-quest"),A=document.querySelectorAll(".js-to-opt-category"),T=document.querySelectorAll(".js-to-opt-params"),E=document.querySelectorAll(".js-to-start"),M=document.querySelectorAll(".js-to-about"),C=document.querySelectorAll(".js-to-game"),x=document.querySelectorAll(".js-to-other-games"),H=document.querySelectorAll(".js-accept-answer"),j=document.querySelectorAll(".js-next-question"),I=(document.querySelector(".count-films span"),document.querySelector(".playground-answers")),O=document.querySelector(".playground-answer"),R=document.querySelector(".playground-answer-input"),W=document.querySelector(".playground-answer-button"),D=document.querySelector(".playground-answer-suggestions"),N=(document.querySelector("#movie-foreign-count"),document.querySelector("#movie-russian-count"),document.querySelector("#movie-soviet-count"),document.querySelector("#series-count"),document.querySelector("#series-foreign-count"),document.querySelector("#series-russian-count"),document.querySelector("#cartoon-foreign-count"),document.querySelector("#cartoon-soviet-count"),[]),P=[{value:"all",label:"Все"}],G=[{value:"all",label:"Все"}],Y=[],F=null,J=null,z=0,B=0,U=0,K=0,Q=[],V=[],X={needTimer:!1,onelife:!1,blackwhite:!1,facts:!1,directAnswer:!1,originalName:!1},Z=10,ee=10,te=null,ne=null;function re(){return(re=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getJSON("/dest/json/films.json?"+(new Date).getMilliseconds(),function(e){return e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ae(e,t){e.classList.add("segment-year-selected"),G.push(t)}function oe(e,t){e.classList.remove("segment-year-selected"),G=G.filter(function(e){return e.value!==t.value})}function ce(e,t,n){var r=2<arguments.length&&void 0!==n&&n,n=document.createElement("div");return n.classList.add("segment-year"),r&&n.classList.add("segment-year-selected"),n.setAttribute("data-value",t),n.setAttribute("data-label",e),n.innerHTML=e,n}function ie(){K=pe().length,f.setAttribute("max",K),f.value=K,e.value=K}function le(){g.style.opacity="0",g.style.animationName="none",clearInterval(ne),clearInterval(te),ee=10}function ue(e,t){var n=e.querySelector("input"),r=n.value;n.checked=!n.checked,e.classList[n.checked?"add":"remove"]("checkbox__checked"),t&&(t=t.querySelector("input"),n.checked=t.checked,e.classList[t.checked?"add":"remove"]("checkbox__checked")),!N.includes(r)&&n.checked?N.push(r):N.forEach(function(e,t){e===r&&N.splice(t,1)})}function se(e){be(),[t,n,a,l,c,u,r,o].forEach(function(e){e.style.display="none"}),e.style.display="block"}function de(e,t){var n,r,a=e,o=document.querySelector('.button__answer[data-value="'+J+'"]');_toConsumableArray(document.querySelectorAll(".button__answer")).forEach(function(e){e.style.pointerEvents="none"}),Y.push(J),a==J?(L.classList.add("active"),setTimeout(function(){L.classList.remove("active")},300),z+=1,U+=1,X.needTimer&&(5<ee&&(ye("Бонус за скорость +<b>"+ee+"</b>!"),z+=ee),le()),L.innerHTML=z,t.classList.add("button__answer-success"),r=e,n=V.find(function(e){if(+r===e.id)return e}),U%10==0&&ye(U+" ответов без ошибок!"),setTimeout(function(){var e,t;n.facts&&X.facts?(k.innerHTML=n.facts[e=0,t=n.facts.length-1,Math.floor(Math.random()*(t-e+1)+e)],w.style.display="block",q.style.display="none"):fe()},800)):(o.classList.add("button__answer-success"),t.classList.add("button__answer-error"),B+=1,U=0,le(),setTimeout(function(){I.innerHTML="",X.onelife?(L.innerHTML=0,Y=[],se(c)):fe()},800))}function ye(e){_.innerHTML=e,_.classList.add("playground-notice-active"),setTimeout(function(){_.classList.remove("playground-notice-active")},800)}function fe(){be(),I.innerHTML="",k.innerHTML="",q.style.display="block",w.style.display="none",R.value="",W.classList.remove("button__answer-success"),W.classList.remove("button__answer-error"),function(){return he.apply(this,arguments)}().then(function(e){S.src=e.photo,S.onload=function(){X.needTimer&&(clearInterval(ne),clearInterval(te),ee=10,g.style.opacity="1",g.style.display="block",g.style.animationName="none",setTimeout(function(){g.style.animationName=""},10),g.style.animationDuration=Z+"s",te=setInterval(function(){--ee},1e3),ne=setTimeout(function(){clearInterval(ne),clearInterval(te),I.innerHTML="",Y=[],se(c)},1e3*Z)),l.classList.remove("playground__loading")},J=e.answer,e.answers.forEach(function(e,t){var n=document.createElement("div");n.classList.add("button"),n.innerHTML=e.name+"&nbsp;<span>("+e.year+")</span>",n.setAttribute("data-value",e.id),n.setAttribute("data-index",t+1),n.classList.add("button__answer"),25<e.name.length+e.year.length&&n.classList.add("button__small"),35<e.name.length+e.year.length&&n.classList.add("button__xsmall"),45<e.name.length+e.year.length&&n.classList.add("button__xxsmall"),I.appendChild(n),n.addEventListener("mousedown",function(){n.style.transform="scale(0.9)"}),n.addEventListener("mouseout",function(){n.style.transform="scale(1)"}),n.addEventListener("mouseup",function(e){de(n.getAttribute("data-value"),n)})})})}function me(e,t){return e.map(function(e){return t.includes(e)}).includes(!0)}function pe(){return Q.filter(function(e){return 0!==e.genres.filter(function(e){return N.includes(e)}).length}).filter(ve)}function ve(e){if(P[0].value.includes("all"))return!0;for(var t=0;t<P.length;t++){var n=P[t],r=e.year;if(r.includes(" - ")&&(r=r.split(" - ")[0]),n.value.includes("-")){var a=_slicedToArray(n.value.split("-"),2),o=a[0],a=a[1];if(+o<=+r&&+r<+a)return!0}if(n.value.includes("before"))if(+r<+n.value.replace("before",""))return!0;if(n.value.includes("after")){n=n.value.replace("after","");if(+e.year>=+n)return!0}}}function he(){return(he=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,r,a,o,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=pe(),r={},a=[],I.classList.add("_hidden"),O.classList.add("_hidden"),Y.length==f.value||Y.length===n.length)return I.innerHTML="",Y=[],s.innerHTML=z,d.innerHTML=B,se(u),document.querySelector(".fireworks-container").innerHTML="",window.fireworks=new Fireworks(document.querySelector(".fireworks-container"),{hue:{min:0,max:345},delay:{min:30,max:45},rocketsPoint:50,speed:1,acceleration:1.2,friction:.96,gravity:1,particles:300,trace:2,explosion:6,autoresize:!0,brightness:{min:50,max:80,decay:{min:.015,max:.03}},boundaries:{visible:!1}}),window.fireworks.start(),Ya.share2("achive-share",{content:{url:"https://ugadai-film.ru",title:"Я угадал "+(t=z,"".concat(t," ").concat(["кадр","кадра","кадров"][4<t%100&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]))+"!"}}),B=z=0,e.abrupt("return");e.next=16;break;case 16:if(!X.directAnswer){for(I.classList.remove("_hidden");a.length<1;)r=n[ge(n.length)],me(r.genres,N)&&!1===Y.includes(r.id)&&a.push(r);for(;a.length<4;)o=n[ge(n.length)],c=o.genres,!a.includes(o)&&o!==r&&me(c,r.genres)&&a.push(o);a=function(e){var t,n,r=e.length;for(;0!==r;)n=Math.floor(Math.random()*r),t=e[--r],e[r]=e[n],e[n]=t;return e}(a=a.map(function(e){return{id:e.id,name:X.originalName?e.nameOrig:e.name,year:e.year}}))}if(X.directAnswer)for(O.classList.remove("_hidden"),i=!1;!i;)r=n[ge(n.length)],Y.includes(r.id)||(i=!0,function(){var t=[],n=pe();W.classList.add("button-disabled"),R.addEventListener("keyup",function(e){t=[],D.innerHTML="","Backspace"!==e.key&&"Delete"!==e.key||W.classList.add("button-disabled");e=n.map(function(e){return{id:e.id,name:X.originalName?e.nameOrig:e.name,year:e.year}});R.value.length&&(t=e.sort(function(e,t){return e.name.localeCompare(t.name)}).filter(function(e){return e.name.toLowerCase().includes(R.value.toLowerCase())}).slice(0,3)).forEach(function(e){var t,n,e=(t=e,(n=document.createElement("div")).classList.add("playground-answer-suggestion"),n.setAttribute("data-name",t.name),n.innerText=t.name+" ("+t.year+")",n.addEventListener("click",function(){R.value=n.getAttribute("data-name"),F=t.id,D.innerHTML="",W.classList.remove("button-disabled"),R.classList.remove("playground-answer-input-opened")}),n);D.appendChild(e)}),R.classList[t.length?"add":"remove"]("playground-answer-input-opened")})}());return l.classList.add("playground__loading"),e.next=21,axios("/php/getFrame.php?id="+r.id).then(function(e){return{photo:e.data,answer:r.id,answers:a}}).catch(function(e){console.log(e)});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}var t},e)}))).apply(this,arguments)}function be(){window.fireworks&&window.fireworks.stop()}function ge(e){return Math.floor(Math.random()*e)}$.getJSON("/dest/json/facts.json?"+(new Date).getMilliseconds(),function(e){V=e}),function(){return re.apply(this,arguments)}().then(function(e){Q=e,void 0===window.HTMLDialogElement&&document.querySelectorAll("dialog").forEach(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve("".concat("https://esm.run/dialog-polyfill")).then(function(e){return _interopRequireWildcard(require(e))});case 2:n=e.sent,n.default.registerDialog(t);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),_toConsumableArray(A).map(function(e){e.addEventListener("click",function(){le(),se(n)})}),_toConsumableArray(T).map(function(e){e.addEventListener("click",function(){var n,r;N.length?(ie(),se(a),function(e){b.innerHTML="",m.innerHTML="Все",P=[{value:"all",label:"Все"}],ie();var t=ce("Все","all",!0);b.appendChild(t),e.forEach(function(e,t){var n=function(e){if(e<1990)return{value:"before1990",label:"до 1990"};if(1990<=e&&e<2e3)return{value:"1990-2000",label:"с 1990 до 2000"};if(2e3<=e&&e<2010)return{value:"2000-2010",label:"с 2000 до 2010"};if(2010<=e&&e<2020)return{value:"2010-2020",label:"с 2010 до 2020"};if(2020<=e)return{value:"after2020",label:"с 2020"}}(t),t=n.value,n=n.label;b.querySelector('.segment-year[data-value="'+t+'"]')||(t=ce(n,t),b.appendChild(t))}),function(){var e=b.querySelectorAll('.segment-year:not([data-value="all"])'),n=document.querySelector('.segment-year[data-value="all"]');_toConsumableArray(e).forEach(function(t){t.addEventListener("click",function(){var e={value:t.getAttribute("data-value"),label:t.getAttribute("data-label")};oe(n,{value:"all",label:"Все"}),t.classList.contains("segment-year-selected")?(oe(t,e),G.length||ae(n,{value:"all",label:"Все"})):ae(t,e)})}),n.addEventListener("click",function(){_toConsumableArray(e).forEach(function(e){var t={value:e.getAttribute("data-value"),label:e.getAttribute("data-label")};oe(e,t)}),ae(n,{value:"all",label:"Все"})})}()}((r=[],n=(n=N).join("|"),Q.forEach(function(e){var t=e.year;t.includes(" - ")&&(t=t.split(" - ")[0]),r[t]||(r[t]=[]),r[t]&&n.includes(e.genres[0])?r[t].push(e.name):r[t].length||delete r[t]}),r))):alert("Выберите категорию")})}),_toConsumableArray(M).map(function(e){e.addEventListener("click",function(){se(r)})}),_toConsumableArray(E).map(function(e){e.addEventListener("click",function(){se(t)})}),_toConsumableArray(x).map(function(e){e.addEventListener("click",function(){se(o)})}),_toConsumableArray(H).map(function(e){e.addEventListener("click",function(){de(F,e)})}),_toConsumableArray(p).map(function(e){e.addEventListener("click",function(){v.close()})}),h.addEventListener("click",function(){v.close(),P=G,ie(),m.innerHTML=P.map(function(e){return e.label}).join(", ")}),m.addEventListener("click",function(){v.showModal(),G=P,_toConsumableArray(document.querySelectorAll(".segment-year")).forEach(function(e){e.classList.remove("segment-year-selected")}),P.forEach(function(e){document.querySelector('.segment-year[data-value="'+e.value+'"]').classList.add("segment-year-selected")})}),_toConsumableArray(C).map(function(e){e.addEventListener("click",function(){z=0,se(l),L.innerHTML=0,U=0,I.innerHTML="",R.innerHTML="",D.innerHTML="",k.innerHTML="",q.style.display="block",w.style.display="none",S.classList.remove("playground-img__grayscale"),X.blackwhite&&S.classList.add("playground-img__grayscale"),fe()})}),_toConsumableArray(j).map(function(e){e.addEventListener("click",function(){fe()})}),_toConsumableArray(i).forEach(function(t){t.addEventListener("click",function(){t.querySelector("input").getAttribute("data-is-parent")?t.parentElement.querySelectorAll(".checkbox__body").forEach(function(e){ue(e,t)}):ue(t)})}),_toConsumableArray(y).forEach(function(n){n.addEventListener("click",function(){var e=n.querySelector("input"),t=e.value;e.checked=!e.checked,n.classList[e.checked?"add":"remove"]("checkbox__checked"),"time"==t&&(X.needTimer=e.checked),"onelife"==t&&(X.onelife=e.checked),"blackwhite"==t&&(X.blackwhite=e.checked),"facts"==t&&(X.facts=e.checked),"directanswer"==t&&(X.directAnswer=e.checked),"originalname"==t&&(X.originalName=e.checked)})})})});