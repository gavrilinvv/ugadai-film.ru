"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function asyncGeneratorStep(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void t(e)}i.done?n(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(n,t){var r=i.apply(e,c);function o(e){asyncGeneratorStep(r,n,t,o,a,"next",e)}function a(e){asyncGeneratorStep(r,n,t,o,a,"throw",e)}o(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var n,t=document.querySelector(".menu"),r=document.querySelector(".menu__shot"),o=document.querySelector(".options-category"),a=document.querySelector(".options-params"),c=document.querySelector(".about"),i=document.querySelector(".playground"),u=document.querySelector(".losing"),s=document.querySelector(".winning"),l=document.querySelector(".winning__answers-correct span"),d=document.querySelector(".winning__answers-incorrect span"),y=document.querySelectorAll(".options .genre .checkbox__body"),m=document.querySelectorAll(".options .option .checkbox__body"),f=document.querySelector(".options .option #inputTargetCount"),p=document.querySelector(".options .option #outputTargetCount"),h=document.querySelector(".playground-timer"),g=document.querySelector(".playground-score span"),v=document.querySelector(".playground-img"),_=document.querySelector(".playground-fact"),b=document.querySelector(".playground-fact__text"),L=document.querySelector(".playground-quest"),S=document.querySelectorAll(".js-to-opt-category"),k=document.querySelectorAll(".js-to-opt-params"),T=document.querySelectorAll(".js-to-start"),q=document.querySelectorAll(".js-to-about"),w=document.querySelectorAll(".js-to-game"),A=document.querySelectorAll(".js-next-question"),M=document.querySelector(".count-films span"),H=document.querySelector(".playground-answers"),x=document.querySelector("#movie-foreign-count"),E=document.querySelector("#movie-russian-count"),C=document.querySelector("#movie-soviet-count"),j=document.querySelector("#series-count"),I=document.querySelector("#cartoon-foreign-count"),G=document.querySelector("#cartoon-soviet-count"),N=[],O=[],D=null,R=0,P=0,F=0,J=[],W=[],z={needTimer:!1,onelife:!1,facts:!1},U=10,B=null;function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getJSON("/dest/json/films.json?"+(new Date).getMilliseconds(),function(e){return e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function K(){h.style.opacity="0",h.style.animationName="none",clearInterval(B)}function Q(e,n){var t=e.querySelector("input"),r=t.value;t.checked=!t.checked,e.classList[t.checked?"add":"remove"]("checkbox__checked"),n&&(n=n.querySelector("input"),t.checked=n.checked,e.classList[n.checked?"add":"remove"]("checkbox__checked")),!N.includes(r)&&t.checked?N.push(r):N.forEach(function(e,n){e===r&&N.splice(n,1)})}function V(e){te(),[t,o,a,i,u,s,c].forEach(function(e){e.style.display="none"}),e.style.display="block"}function X(e,n){var t,r,o=e;_toConsumableArray(document.querySelectorAll(".button__answer")).forEach(function(e){e.style.pointerEvents="none"}),O.push(D),o==D?(g.classList.add("active"),setTimeout(function(){g.classList.remove("active")},300),R+=1,F+=1,g.innerHTML=++g.innerHTML,n.classList.add("button__answer-success"),r=e,t=W.find(function(e){if(+r===e.id)return e}),z.needTimer&&K(),F%10==0&&console.log(F+" ответов без ошибок!"),setTimeout(function(){t.facts&&z.facts?(b.innerHTML=t.facts[ae(0,t.facts.length-1)],_.style.display="block",L.style.display="none"):Y()},800)):(n.classList.add("button__answer-error"),P+=1,F=0,setTimeout(function(){H.innerHTML="",z.onelife?(g.innerHTML=0,O=[],V(u)):Y()},800))}function Y(){te(),H.innerHTML="",b.innerHTML="",L.style.display="block",_.style.display="none",function(){return ne.apply(this,arguments)}().then(function(e){v.src=e.photo,v.onload=function(){z.needTimer&&(clearInterval(B),h.style.opacity="1",h.style.display="block",h.style.animationName="none",setTimeout(function(){h.style.animationName=""},10),h.style.animationDuration=U+"s",B=setTimeout(function(){clearInterval(B),H.innerHTML="",O=[],V(u)},1e3*U)),i.classList.remove("playground__loading")},D=e.answer,e.answers.forEach(function(e){var n=document.createElement("div");n.classList.add("button"),n.innerHTML=e.name+" <span>("+e.year+")</span>",n.setAttribute("data-value",e.id),n.classList.add("button__answer"),25<e.name.length+e.year.length&&n.classList.add("button__small"),35<e.name.length+e.year.length&&n.classList.add("button__xsmall"),45<e.name.length+e.year.length&&n.classList.add("button__xxsmall"),H.appendChild(n),n.addEventListener("mousedown",function(){n.style.transform="scale(0.9)"}),n.addEventListener("mouseout",function(){n.style.transform="scale(1)"}),n.addEventListener("mouseup",function(){X(n.getAttribute("data-value"),n)})})})}function Z(e,n){return e.map(function(e){return n.includes(e)}).includes(!0)}function ee(){return J.filter(function(e){return 0!==e.genres.filter(function(e){return N.includes(e)}).length})}function ne(){return(ne=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,t,r,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ee(),t={},r=[],O.length==f.value||O.length===n.length)return H.innerHTML="",O=[],l.innerHTML=R,d.innerHTML=P,V(s),document.querySelector(".fireworks-container").innerHTML="",window.fireworks=new Fireworks(document.querySelector(".fireworks-container"),{hue:{min:0,max:345},delay:{min:30,max:45},rocketsPoint:50,speed:1,acceleration:1.2,friction:.96,gravity:1,particles:300,trace:2,explosion:6,autoresize:!0,brightness:{min:50,max:80,decay:{min:.015,max:.03}},boundaries:{visible:!1}}),window.fireworks.start(),P=R=0,e.abrupt("return");e.next=13;break;case 13:for(;r.length<1;)t=J[oe(J.length)],Z(t.genres,N)&&!1===O.includes(t.id)&&r.push(t);for(;r.length<4;)o=J[oe(J.length)],a=o.genres,!r.includes(o)&&o!==t&&Z(a,t.genres)&&r.push(o);return r=function(e){var n,t,r=e.length;for(;0!==r;)t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n;return e}(r=r.map(function(e){return{id:e.id,name:e.name,year:e.year}})),i.classList.add("playground__loading"),e.next=20,axios("/php/getFrame.php?id="+t.id).then(function(e){return{photo:e.data,answer:t.id,answers:r}}).catch(function(e){console.log(e)});case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}},e)}))).apply(this,arguments)}function te(){window.fireworks&&window.fireworks.stop()}function re(n){return J.filter(function(e){return e.genres[0]===n}).length}function oe(e){return Math.floor(Math.random()*e)}function ae(e,n){return Math.floor(Math.random()*(n-e+1)+e)}$.getJSON("/dest/json/facts.json?"+(new Date).getMilliseconds(),function(e){W=e}),function(){return e.apply(this,arguments)}().then(function(e){J=e,M.innerHTML=J.length,x.innerHTML=re("movie-foreign"),E.innerHTML=re("movie-russian"),C.innerHTML=re("movie-soviet"),j.innerHTML=re("series"),I.innerHTML=re("cartoon-foreign"),G.innerHTML=re("cartoon-soviet"),r.style.backgroundImage='url("/src/img/film'+ae(1,3)+'.webp")',_toConsumableArray(S).map(function(e){e.addEventListener("click",function(){K(),V(o)})}),_toConsumableArray(k).map(function(e){e.addEventListener("click",function(){N.length?(n=ee().length,f.setAttribute("max",n),f.value=n,p.value=n,V(a)):alert("Выберите категорию")})}),_toConsumableArray(q).map(function(e){e.addEventListener("click",function(){V(c)})}),_toConsumableArray(T).map(function(e){e.addEventListener("click",function(){V(t)})}),_toConsumableArray(w).map(function(e){e.addEventListener("click",function(){V(i),g.innerHTML=0,H.innerHTML="",b.innerHTML="",L.style.display="block",_.style.display="none",Y()})}),_toConsumableArray(A).map(function(e){e.addEventListener("click",function(){Y()})}),_toConsumableArray(y).forEach(function(n){n.addEventListener("click",function(){n.querySelector("input").getAttribute("data-is-parent")?n.parentElement.querySelectorAll(".checkbox__body").forEach(function(e){Q(e,n)}):Q(n)})}),_toConsumableArray(m).forEach(function(t){t.addEventListener("click",function(){var e=t.querySelector("input"),n=e.value;e.checked=!e.checked,t.classList[e.checked?"add":"remove"]("checkbox__checked"),"time"==n&&(z.needTimer=e.checked),"onelife"==n&&(z.onelife=e.checked),"facts"==n&&(z.facts=e.checked)})})})});