"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,n){if(e){if("string"==typeof e)return _arrayLikeToArray(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(t="Object"===t&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,n):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function asyncGeneratorStep(e,n,t,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void t(e)}i.done?n(u):Promise.resolve(u).then(r,o)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(n,t){var r=i.apply(e,c);function o(e){asyncGeneratorStep(r,n,t,o,a,"next",e)}function a(e){asyncGeneratorStep(r,n,t,o,a,"throw",e)}o(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var r,n=document.querySelector(".menu"),t=(document.querySelector(".menu__shot"),document.querySelector(".options-category")),o=document.querySelector(".options-params"),a=document.querySelector(".about"),s=document.querySelector(".playground"),c=document.querySelector(".other-games"),i=document.querySelector(".losing"),l=document.querySelector(".winning"),d=document.querySelector(".winning__answers-correct span"),m=document.querySelector(".winning__answers-incorrect span"),u=document.querySelectorAll(".options .genre .checkbox__body"),y=document.querySelectorAll(".options .option .checkbox__body"),f=document.querySelector(".options .option #inputTargetCount"),p=document.querySelector(".options .option #outputTargetCount"),h=document.querySelector(".playground-timer"),g=document.querySelector(".playground-notice"),v=document.querySelector(".playground-score span"),b=document.querySelector(".playground-img"),_=document.querySelector(".playground-fact"),L=document.querySelector(".playground-fact__text"),S=document.querySelector(".playground-quest"),w=document.querySelectorAll(".js-to-opt-category"),k=document.querySelectorAll(".js-to-opt-params"),q=document.querySelectorAll(".js-to-start"),A=document.querySelectorAll(".js-to-about"),T=document.querySelectorAll(".js-to-game"),M=document.querySelectorAll(".js-to-other-games"),E=document.querySelectorAll(".js-accept-answer"),x=document.querySelectorAll(".js-next-question"),H=document.querySelector(".count-films span"),C=document.querySelector(".playground-answers"),j=document.querySelector(".playground-answer"),I=document.querySelector(".playground-answer-input"),N=document.querySelector(".playground-answer-button"),O=document.querySelector(".playground-answer-suggestions"),G=(document.querySelector("#movie-foreign-count"),document.querySelector("#movie-russian-count"),document.querySelector("#movie-soviet-count"),document.querySelector("#series-count"),document.querySelector("#series-foreign-count"),document.querySelector("#series-russian-count"),document.querySelector("#cartoon-foreign-count"),document.querySelector("#cartoon-soviet-count"),[]),D=[],R=null,P=null,F=0,J=0,W=0,z=[],B=[],U={needTimer:!1,onelife:!1,facts:!1,directAnswer:!1,originalName:!1},Y=10,K=10,Q=null,V=null;function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getJSON("/dest/json/films.json?"+(new Date).getMilliseconds(),function(e){return e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function X(){h.style.opacity="0",h.style.animationName="none",clearInterval(V),clearInterval(Q),K=10}function Z(e,n){var t=e.querySelector("input"),r=t.value;t.checked=!t.checked,e.classList[t.checked?"add":"remove"]("checkbox__checked"),n&&(n=n.querySelector("input"),t.checked=n.checked,e.classList[n.checked?"add":"remove"]("checkbox__checked")),!G.includes(r)&&t.checked?G.push(r):G.forEach(function(e,n){e===r&&G.splice(n,1)})}function ee(e){ie(),[n,t,o,s,i,l,a,c].forEach(function(e){e.style.display="none"}),e.style.display="block"}function ne(e,n){var t,r,o=e,a=document.querySelector('.button__answer[data-value="'+P+'"]');_toConsumableArray(document.querySelectorAll(".button__answer")).forEach(function(e){e.style.pointerEvents="none"}),D.push(P),o==P?(v.classList.add("active"),setTimeout(function(){v.classList.remove("active")},300),F+=1,W+=1,U.needTimer&&(5<K&&(te("Бонус за скорость +<b>"+K+"</b>!"),F+=K),X()),v.innerHTML=F,n.classList.add("button__answer-success"),r=e,t=B.find(function(e){if(+r===e.id)return e}),W%10==0&&te(W+" ответов без ошибок!"),setTimeout(function(){var e,n;t.facts&&U.facts?(L.innerHTML=t.facts[e=0,n=t.facts.length-1,Math.floor(Math.random()*(n-e+1)+e)],_.style.display="block",S.style.display="none"):re()},800)):(a.classList.add("button__answer-success"),n.classList.add("button__answer-error"),J+=1,W=0,X(),setTimeout(function(){C.innerHTML="",U.onelife?(v.innerHTML=0,D=[],ee(i)):re()},800))}function te(e){g.innerHTML=e,g.classList.add("playground-notice-active"),setTimeout(function(){g.classList.remove("playground-notice-active")},800)}function re(){ie(),C.innerHTML="",L.innerHTML="",S.style.display="block",_.style.display="none",I.value="",N.classList.remove("button__answer-success"),N.classList.remove("button__answer-error"),function(){return ce.apply(this,arguments)}().then(function(e){b.src=e.photo,b.onload=function(){U.needTimer&&(clearInterval(V),clearInterval(Q),K=10,h.style.opacity="1",h.style.display="block",h.style.animationName="none",setTimeout(function(){h.style.animationName=""},10),h.style.animationDuration=Y+"s",Q=setInterval(function(){--K},1e3),V=setTimeout(function(){clearInterval(V),clearInterval(Q),C.innerHTML="",D=[],ee(i)},1e3*Y)),s.classList.remove("playground__loading")},P=e.answer,e.answers.forEach(function(e,n){var t=document.createElement("div");t.classList.add("button"),t.innerHTML=e.name+"&nbsp;<span>("+e.year+")</span>",t.setAttribute("data-value",e.id),t.setAttribute("data-index",n+1),t.classList.add("button__answer"),25<e.name.length+e.year.length&&t.classList.add("button__small"),35<e.name.length+e.year.length&&t.classList.add("button__xsmall"),45<e.name.length+e.year.length&&t.classList.add("button__xxsmall"),C.appendChild(t),t.addEventListener("mousedown",function(){t.style.transform="scale(0.9)"}),t.addEventListener("mouseout",function(){t.style.transform="scale(1)"}),t.addEventListener("mouseup",function(e){ne(t.getAttribute("data-value"),t)})})})}function oe(e,n){return e.map(function(e){return n.includes(e)}).includes(!0)}function ae(){return z.filter(function(e){return 0!==e.genres.filter(function(e){return G.includes(e)}).length})}function ce(){return(ce=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,o,a,c,i,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ae(),r={},o=[],C.classList.add("_hidden"),j.classList.add("_hidden"),D.length==f.value||D.length===t.length)return C.innerHTML="",D=[],d.innerHTML=F,m.innerHTML=J,ee(l),document.querySelector(".fireworks-container").innerHTML="",window.fireworks=new Fireworks(document.querySelector(".fireworks-container"),{hue:{min:0,max:345},delay:{min:30,max:45},rocketsPoint:50,speed:1,acceleration:1.2,friction:.96,gravity:1,particles:300,trace:2,explosion:6,autoresize:!0,brightness:{min:50,max:80,decay:{min:.015,max:.03}},boundaries:{visible:!1}}),window.fireworks.start(),Ya.share2("achive-share",{content:{url:"https://ugadai-film.ru",title:"Я угадал "+(n=F,"".concat(n," ").concat(["кадр","кадра","кадров"][4<n%100&&n%100<20?2:[2,0,1,1,1,2][n%10<5?n%10:5]]))+"!"}}),J=F=0,e.abrupt("return");e.next=16;break;case 16:if(!U.directAnswer){for(C.classList.remove("_hidden");o.length<1;)r=z[ue(z.length)],oe(r.genres,G)&&!1===D.includes(r.id)&&o.push(r);for(;o.length<4;)a=z[ue(z.length)],c=a.genres,!o.includes(a)&&a!==r&&oe(c,r.genres)&&o.push(a);o=function(e){var n,t,r=e.length;for(;0!==r;)t=Math.floor(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n;return e}(o=o.map(function(e){return{id:e.id,name:U.originalName?e.nameOrig:e.name,year:e.year}}))}if(U.directAnswer)for(j.classList.remove("_hidden"),i=!1,u=function(n){return z.filter(function(e){return n.includes(e.genres.join(""))})}(G);!i;)r=u[ue(u.length)],D.includes(r.id)||(i=!0,function(){var n=[];N.classList.add("button-disabled"),I.addEventListener("keyup",function(e){n=[],O.innerHTML="","Backspace"!==e.key&&"Delete"!==e.key||N.classList.add("button-disabled");e=z.map(function(e){return{id:e.id,name:U.originalName?e.nameOrig:e.name,year:e.year}});I.value.length&&(n=e.sort(function(e,n){return e.name.localeCompare(n.name)}).filter(function(e){return e.name.toLowerCase().includes(I.value.toLowerCase())}).slice(0,3)).forEach(function(e){var n,t,e=(n=e,(t=document.createElement("div")).classList.add("playground-answer-suggestion"),t.setAttribute("data-name",n.name),t.innerText=n.name+" ("+n.year+")",t.addEventListener("click",function(){I.value=t.getAttribute("data-name"),R=n.id,O.innerHTML="",N.classList.remove("button-disabled"),I.classList.remove("playground-answer-input-opened")}),t);O.appendChild(e)}),I.classList[n.length?"add":"remove"]("playground-answer-input-opened")})}());return s.classList.add("playground__loading"),e.next=21,axios("/php/getFrame.php?id="+r.id).then(function(e){return{photo:e.data,answer:r.id,answers:o}}).catch(function(e){console.log(e)});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}var n},e)}))).apply(this,arguments)}function ie(){window.fireworks&&window.fireworks.stop()}function ue(e){return Math.floor(Math.random()*e)}$.getJSON("/dest/json/facts.json?"+(new Date).getMilliseconds(),function(e){B=e}),function(){return e.apply(this,arguments)}().then(function(e){z=e,H.innerHTML=z.length,_toConsumableArray(w).map(function(e){e.addEventListener("click",function(){X(),ee(t)})}),_toConsumableArray(k).map(function(e){e.addEventListener("click",function(){var n,t;G.length?(r=ae().length,f.setAttribute("max",r),f.value=r,p.value=r,n=G,t=[],z.forEach(function(e){t[e.year]||(t[e.year]=[]),t[e.year]&&n[0]===e.genres[0]&&t[e.year].push(e.name)}),console.log(t),ee(o)):alert("Выберите категорию")})}),_toConsumableArray(A).map(function(e){e.addEventListener("click",function(){ee(a)})}),_toConsumableArray(q).map(function(e){e.addEventListener("click",function(){ee(n)})}),_toConsumableArray(M).map(function(e){e.addEventListener("click",function(){ee(c)})}),_toConsumableArray(E).map(function(e){e.addEventListener("click",function(){ne(R,e)})}),_toConsumableArray(T).map(function(e){e.addEventListener("click",function(){F=0,ee(s),v.innerHTML=0,W=0,C.innerHTML="",I.innerHTML="",O.innerHTML="",L.innerHTML="",S.style.display="block",_.style.display="none",re()})}),_toConsumableArray(x).map(function(e){e.addEventListener("click",function(){re()})}),_toConsumableArray(u).forEach(function(n){n.addEventListener("click",function(){n.querySelector("input").getAttribute("data-is-parent")?n.parentElement.querySelectorAll(".checkbox__body").forEach(function(e){Z(e,n)}):Z(n)})}),_toConsumableArray(y).forEach(function(t){t.addEventListener("click",function(){var e=t.querySelector("input"),n=e.value;e.checked=!e.checked,t.classList[e.checked?"add":"remove"]("checkbox__checked"),"time"==n&&(U.needTimer=e.checked),"onelife"==n&&(U.onelife=e.checked),"facts"==n&&(U.facts=e.checked),"directanswer"==n&&(U.directAnswer=e.checked),"originalname"==n&&(U.originalName=e.checked)})})})});