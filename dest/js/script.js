"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,o,a,c){try{var u=e[a](c),i=u.value}catch(e){return void n(e)}u.done?t(i):Promise.resolve(i).then(r,o)}function _asyncToGenerator(u){return function(){var e=this,c=arguments;return new Promise(function(t,n){var r=u.apply(e,c);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var t,n=document.querySelector(".menu"),r=(document.querySelector(".menu__shot"),document.querySelector(".options-category")),o=document.querySelector(".options-params"),a=document.querySelector(".about"),u=document.querySelector(".playground"),c=document.querySelector(".other-games"),i=document.querySelector(".losing"),s=document.querySelector(".winning"),l=document.querySelector(".winning__answers-correct span"),d=document.querySelector(".winning__answers-incorrect span"),y=document.querySelectorAll(".options .genre .checkbox__body"),m=document.querySelectorAll(".options .option .checkbox__body"),f=document.querySelector(".options .option #inputTargetCount"),p=document.querySelector(".options .option #outputTargetCount"),h=document.querySelector(".playground-timer"),g=document.querySelector(".playground-notice"),v=document.querySelector(".playground-score span"),b=document.querySelector(".playground-img"),_=document.querySelector(".playground-fact"),S=document.querySelector(".playground-fact__text"),k=document.querySelector(".playground-quest"),L=document.querySelectorAll(".js-to-opt-category"),q=document.querySelectorAll(".js-to-opt-params"),w=document.querySelectorAll(".js-to-start"),A=document.querySelectorAll(".js-to-about"),T=document.querySelectorAll(".js-to-game"),M=document.querySelectorAll(".js-to-other-games"),x=document.querySelectorAll(".js-next-question"),E=(document.querySelector(".count-films span"),document.querySelector(".playground-answers")),H=(document.querySelector("#movie-foreign-count"),document.querySelector("#movie-russian-count"),document.querySelector("#movie-soviet-count"),document.querySelector("#series-count"),document.querySelector("#series-foreign-count"),document.querySelector("#series-russian-count"),document.querySelector("#cartoon-foreign-count"),document.querySelector("#cartoon-soviet-count"),[]),C=[],j=null,I=0,G=0,N=0,O=[],D=[],R={needTimer:!1,onelife:!1,facts:!1},P=10,F=10,J=null,W=null;function e(){return(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getJSON("/dest/json/films.json?"+(new Date).getMilliseconds(),function(e){return e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function z(){h.style.opacity="0",h.style.animationName="none",clearInterval(W),clearInterval(J),F=10}function U(e,t){var n=e.querySelector("input"),r=n.value;n.checked=!n.checked,e.classList[n.checked?"add":"remove"]("checkbox__checked"),t&&(t=t.querySelector("input"),n.checked=t.checked,e.classList[t.checked?"add":"remove"]("checkbox__checked")),!H.includes(r)&&n.checked?H.push(r):H.forEach(function(e,t){e===r&&H.splice(t,1)})}function Y(e){ee(),[n,r,o,u,i,s,a,c].forEach(function(e){e.style.display="none"}),e.style.display="block"}function B(e,t){var n,r,o=e;_toConsumableArray(document.querySelectorAll(".button__answer")).forEach(function(e){e.style.pointerEvents="none"}),C.push(j),o==j?(v.classList.add("active"),setTimeout(function(){v.classList.remove("active")},300),I+=1,N+=1,R.needTimer&&(5<F&&(K("Бонус за скорость +<b>"+F+"</b>!"),I+=F),z()),v.innerHTML=I,t.classList.add("button__answer-success"),r=e,n=D.find(function(e){if(+r===e.id)return e}),N%10==0&&K(N+" ответов без ошибок!"),setTimeout(function(){var e,t;n.facts&&R.facts?(S.innerHTML=n.facts[e=0,t=n.facts.length-1,Math.floor(Math.random()*(t-e+1)+e)],_.style.display="block",k.style.display="none"):Q()},800)):(t.classList.add("button__answer-error"),G+=1,N=0,z(),setTimeout(function(){E.innerHTML="",R.onelife?(v.innerHTML=0,C=[],Y(i)):Q()},800))}function K(e){g.innerHTML=e,g.classList.add("playground-notice-active"),setTimeout(function(){g.classList.remove("playground-notice-active")},800)}function Q(){ee(),E.innerHTML="",S.innerHTML="",k.style.display="block",_.style.display="none",function(){return Z.apply(this,arguments)}().then(function(e){b.src=e.photo,b.onload=function(){R.needTimer&&(clearInterval(W),clearInterval(J),F=10,h.style.opacity="1",h.style.display="block",h.style.animationName="none",setTimeout(function(){h.style.animationName=""},10),h.style.animationDuration=P+"s",J=setInterval(function(){--F},1e3),W=setTimeout(function(){clearInterval(W),clearInterval(J),E.innerHTML="",C=[],Y(i)},1e3*P)),u.classList.remove("playground__loading")},j=e.answer,e.answers.forEach(function(e,t){var n=document.createElement("div");n.classList.add("button"),n.innerHTML=e.name+"&nbsp;<span>("+e.year+")</span>",n.setAttribute("data-value",e.id),n.setAttribute("data-index",t+1),n.classList.add("button__answer"),25<e.name.length+e.year.length&&n.classList.add("button__small"),35<e.name.length+e.year.length&&n.classList.add("button__xsmall"),45<e.name.length+e.year.length&&n.classList.add("button__xxsmall"),E.appendChild(n),n.addEventListener("mousedown",function(){n.style.transform="scale(0.9)"}),n.addEventListener("mouseout",function(){n.style.transform="scale(1)"}),n.addEventListener("mouseup",function(e){B(n.getAttribute("data-value"),n)})})})}function V(e,t){return e.map(function(e){return t.includes(e)}).includes(!0)}function X(){return O.filter(function(e){return 0!==e.genres.filter(function(e){return H.includes(e)}).length})}function Z(){return(Z=_asyncToGenerator(regeneratorRuntime.mark(function e(){var n,r,o,a,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=X(),r={},o=[],C.length==f.value||C.length===n.length)return E.innerHTML="",C=[],l.innerHTML=I,d.innerHTML=G,Y(s),document.querySelector(".fireworks-container").innerHTML="",window.fireworks=new Fireworks(document.querySelector(".fireworks-container"),{hue:{min:0,max:345},delay:{min:30,max:45},rocketsPoint:50,speed:1,acceleration:1.2,friction:.96,gravity:1,particles:300,trace:2,explosion:6,autoresize:!0,brightness:{min:50,max:80,decay:{min:.015,max:.03}},boundaries:{visible:!1}}),window.fireworks.start(),Ya.share2("achive-share",{content:{url:"https://ugadai-film.ru",title:"Я угадал "+(t=I,"".concat(t," ").concat(["кадр","кадра","кадров"][4<t%100&&t%100<20?2:[2,0,1,1,1,2][t%10<5?t%10:5]]))+"!"}}),G=I=0,e.abrupt("return");e.next=14;break;case 14:for(;o.length<1;)r=O[te(O.length)],V(r.genres,H)&&!1===C.includes(r.id)&&o.push(r);for(;o.length<4;)a=O[te(O.length)],c=a.genres,!o.includes(a)&&a!==r&&V(c,r.genres)&&o.push(a);return o=function(e){var t,n,r=e.length;for(;0!==r;)n=Math.floor(Math.random()*r),t=e[--r],e[r]=e[n],e[n]=t;return e}(o=o.map(function(e){return{id:e.id,name:e.name,year:e.year}})),u.classList.add("playground__loading"),e.next=21,axios("/php/getFrame.php?id="+r.id).then(function(e){return{photo:e.data,answer:r.id,answers:o}}).catch(function(e){console.log(e)});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}var t},e)}))).apply(this,arguments)}function ee(){window.fireworks&&window.fireworks.stop()}function te(e){return Math.floor(Math.random()*e)}$.getJSON("/dest/json/facts.json?"+(new Date).getMilliseconds(),function(e){D=e}),function(){return e.apply(this,arguments)}().then(function(e){O=e,_toConsumableArray(L).map(function(e){e.addEventListener("click",function(){z(),Y(r)})}),_toConsumableArray(q).map(function(e){e.addEventListener("click",function(){H.length?(t=X().length,f.setAttribute("max",t),f.value=t,p.value=t,Y(o)):alert("Выберите категорию")})}),_toConsumableArray(A).map(function(e){e.addEventListener("click",function(){Y(a)})}),_toConsumableArray(w).map(function(e){e.addEventListener("click",function(){Y(n)})}),_toConsumableArray(M).map(function(e){e.addEventListener("click",function(){Y(c)})}),_toConsumableArray(T).map(function(e){e.addEventListener("click",function(){I=0,Y(u),v.innerHTML=0,N=0,E.innerHTML="",S.innerHTML="",k.style.display="block",_.style.display="none",Q()})}),_toConsumableArray(x).map(function(e){e.addEventListener("click",function(){Q()})}),_toConsumableArray(y).forEach(function(t){t.addEventListener("click",function(){t.querySelector("input").getAttribute("data-is-parent")?t.parentElement.querySelectorAll(".checkbox__body").forEach(function(e){U(e,t)}):U(t)})}),_toConsumableArray(m).forEach(function(n){n.addEventListener("click",function(){var e=n.querySelector("input"),t=e.value;e.checked=!e.checked,n.classList[e.checked?"add":"remove"]("checkbox__checked"),"time"==t&&(R.needTimer=e.checked),"onelife"==t&&(R.onelife=e.checked),"facts"==t&&(R.facts=e.checked)})})})});