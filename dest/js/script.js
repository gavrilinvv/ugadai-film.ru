"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_getRequireWildcardCache=function(e){return e?n:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,r,a={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=o?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(a,n,r):a[n]=e[n]);return a.default=e,t&&t.set(e,a),a}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],c=!0,i=!1;try{for(n=n.call(e);!(c=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);c=!0);}catch(e){i=!0,a=e}finally{try{c||null==n.return||n.return()}finally{if(i)throw a}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function asyncGeneratorStep(e,t,n,r,a,o,c){try{var i=e[o](c),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,a)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,n){var r=i.apply(e,c);function a(e){asyncGeneratorStep(r,t,n,a,o,"next",e)}function o(e){asyncGeneratorStep(r,t,n,a,o,"throw",e)}a(void 0)})}}document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".menu"),n=(document.querySelector(".menu__shot"),document.querySelector(".options-category")),a=document.querySelector(".options-params"),r=document.querySelector(".about"),i=document.querySelector(".playground"),o=document.querySelector(".other-games"),c=document.querySelector(".losing"),l=document.querySelector(".winning"),u=(document.querySelector(".winning__answers-correct span"),document.querySelector(".winning__answers-incorrect span"),document.querySelectorAll(".statistics")),s=document.querySelectorAll(".options .genre .checkbox__body"),d=document.querySelectorAll(".options .option .checkbox__body"),f=document.querySelector(".options .option #inputTargetCount"),e=document.querySelector(".options .option #outputTargetCount"),m=document.querySelector("#years"),y=document.querySelectorAll(".js-close-modal"),p=document.querySelector(".modal#modalYears"),v=document.querySelector(".js-save-years"),h=document.querySelector("#modalYears .years-grid"),b=document.querySelector(".playground-timer"),g=document.querySelector(".playground-notice"),_=document.querySelector(".playground-score span"),L=document.querySelector(".playground-img"),S=document.querySelector(".playground-fact"),w=document.querySelector(".playground-fact__text"),k=document.querySelector(".playground-quest"),q=document.querySelectorAll(".js-to-opt-category"),A=document.querySelectorAll(".js-to-opt-params"),T=document.querySelectorAll(".js-to-start"),E=document.querySelectorAll(".js-to-about"),M=document.querySelectorAll(".js-to-game"),C=document.querySelectorAll(".js-to-other-games"),H=document.querySelectorAll(".js-accept-answer"),x=document.querySelectorAll(".js-next-question"),j=document.querySelector(".count-films span"),I=document.querySelector(".playground-answers"),O=document.querySelector(".playground-answer"),R=document.querySelector(".playground-answer-input"),W=document.querySelector(".playground-answer-button"),D=document.querySelector(".playground-answer-suggestions"),N=(document.querySelector("#movie-foreign-count"),document.querySelector("#movie-russian-count"),document.querySelector("#movie-soviet-count"),document.querySelector("#series-count"),document.querySelector("#series-foreign-count"),document.querySelector("#series-russian-count"),document.querySelector("#cartoon-foreign-count"),document.querySelector("#cartoon-soviet-count"),[]),P=0,G=[],Y=[{value:"all",label:"Все"}],F=[{value:"all",label:"Все"}],J=[],z=null,B=null,U=0,K=0,Q=0,V=0,X=[],Z=[],ee={needTimer:!1,onelife:!1,blackwhite:!1,facts:!1,directAnswer:!1,originalName:!1},te=10,ne=10,re=null,ae=null;function oe(){return(oe=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$.getJSON("/dest/json/films.json?"+(new Date).getMilliseconds(),function(e){return e});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ce(e,t){e.classList.add("segment-year-selected"),F.push(t)}function ie(e,t){e.classList.remove("segment-year-selected"),F=F.filter(function(e){return e.value!==t.value})}function le(e,t,n){var r=2<arguments.length&&void 0!==n&&n,n=document.createElement("div");return n.classList.add("segment-year"),r&&n.classList.add("segment-year-selected"),n.setAttribute("data-value",t),n.setAttribute("data-label",e),n.innerHTML=e,n}function ue(){V=_e().length,f.setAttribute("max",V),f.value=V,e.value=V}function se(){b.style.opacity="0",b.style.animationName="none",clearInterval(ae),clearInterval(re),ne=10}function de(e,t){var n=e.querySelector("input"),r=n.value;n.checked=!n.checked,e.classList[n.checked?"add":"remove"]("checkbox__checked"),t&&(t=t.querySelector("input"),n.checked=t.checked,e.classList[t.checked?"add":"remove"]("checkbox__checked")),!G.includes(r)&&n.checked?G.push(r):G.forEach(function(e,t){e===r&&G.splice(t,1)})}function fe(e){qe(),[t,n,a,i,c,l,r,o].forEach(function(e){e.style.display="none"}),e.style.display="block"}function me(e,t){N[e]||(N[e]={correct:0,incorrect:0}),N[e][t]?N[e][t]++:N[e][t]=1}function ye(){Object.keys(N).forEach(function(e){pe(e,N[e].correct,N[e].incorrect)}),P&&pe("Бонус за скорость",P,0,!0),pe("Итого очков",U+P,K)}function pe(e,t,n,r){var a=3<arguments.length&&void 0!==r&&r,o=document.createElement("div");o.classList.add("stat");var c=document.createElement("span");c.innerHTML=function(e){var t;switch(e){case"movie-foreign":t="Зарубежные фильмы";break;case"movie-russian":t="Российские фильмы";break;case"movie-soviet":t="Советские фильмы";break;case"series-foreign":t="Зарубежные сериалы";break;case"series-russian":t="Российские сериалы";break;case"cartoon-foreign":t="Зарубежные мультфильмы";break;case"cartoon-russian":t="Российские мультфильмы";break;case"cartoon-soviet":t="Советские мультфильмы";break;default:t=e}return t}(e),c.classList.add("stat_name");r=document.createElement("span"),e=document.createElement("div");e.classList.add("winning__answers-correct"),e.innerHTML="&#9989;"+t;t=document.createElement("div");t.classList.add("winning__answers-incorrect"),t.innerHTML=a?"":"&#10060;"+n,r.appendChild(e),r.appendChild(t),r.classList.add("stat_value"),o.appendChild(c),o.appendChild(r),u.forEach(function(e){e.appendChild(o)})}function ve(e,t){var n,r,a=e,o=document.querySelector('.button__answer[data-value="'+B+'"]');_toConsumableArray(document.querySelectorAll(".button__answer")).forEach(function(e){e.style.pointerEvents="none"}),J.push(B),a==B?(_.classList.add("active"),setTimeout(function(){_.classList.remove("active")},300),U+=1,Q+=1,me(Se(B).genres[0],"correct"),ee.needTimer&&(5<ne&&(he("Бонус за скорость +<b>"+ne+"</b>!"),P+=parseInt(ne/2)),se()),_.innerHTML=U,t.classList.add("button__answer-success"),r=e,n=Z.find(function(e){if(+r===e.id)return e}),Q%10==0&&he(Q+" ответов без ошибок!"),setTimeout(function(){var e,t;n.facts&&ee.facts?(w.innerHTML=n.facts[e=0,t=n.facts.length-1,Math.floor(Math.random()*(t-e+1)+e)],S.style.display="block",k.style.display="none"):be()},800)):(o.classList.add("button__answer-success"),t.classList.add("button__answer-error"),K+=1,Q=0,me(Se(B).genres[0],"incorrect"),se(),setTimeout(function(){I.innerHTML="",ee.onelife?(_.innerHTML=0,J=[],fe(c),ye(),we()):be()},800))}function he(e){g.innerHTML=e,g.classList.add("playground-notice-active"),setTimeout(function(){g.classList.remove("playground-notice-active")},800)}function be(){qe(),I.innerHTML="",w.innerHTML="",k.style.display="block",S.style.display="none",R.value="",W.classList.remove("button__answer-success"),W.classList.remove("button__answer-error"),function(){return ke.apply(this,arguments)}().then(function(e){L.src=e.photo,L.onload=function(){ee.needTimer&&(clearInterval(ae),clearInterval(re),ne=10,b.style.opacity="1",b.style.display="block",b.style.animationName="none",setTimeout(function(){b.style.animationName=""},10),b.style.animationDuration=te+"s",re=setInterval(function(){--ne},1e3),ae=setTimeout(function(){clearInterval(ae),clearInterval(re),I.innerHTML="",J=[],fe(c),ye(),we()},1e3*te)),i.classList.remove("playground__loading")},B=e.answer,e.answers.forEach(function(e,t){var n=document.createElement("div");n.classList.add("button"),n.innerHTML=e.name+"&nbsp;<span>("+e.year+")</span>",n.setAttribute("data-value",e.id),n.setAttribute("data-index",t+1),n.classList.add("button__answer"),25<e.name.length+e.year.length&&n.classList.add("button__small"),35<e.name.length+e.year.length&&n.classList.add("button__xsmall"),45<e.name.length+e.year.length&&n.classList.add("button__xxsmall"),I.appendChild(n),n.addEventListener("mousedown",function(){n.style.transform="scale(0.9)"}),n.addEventListener("mouseout",function(){n.style.transform="scale(1)"}),n.addEventListener("mouseup",function(e){ve(n.getAttribute("data-value"),n)})})})}function ge(e,t){return e.map(function(e){return t.includes(e)}).includes(!0)}function _e(){return X.filter(function(e){return 0!==e.genres.filter(function(e){return G.includes(e)}).length}).filter(Le)}function Le(e){if(Y[0].value.includes("all"))return!0;for(var t=0;t<Y.length;t++){var n=Y[t],r=e.year;if(r.includes(" - ")&&(r=r.split(" - ")[0]),n.value.includes("-")){var a=_slicedToArray(n.value.split("-"),2),o=a[0],a=a[1];if(+o<=+r&&+r<+a)return!0}if(n.value.includes("before"))if(+r<+n.value.replace("before",""))return!0;if(n.value.includes("after")){n=n.value.replace("after","");if(+e.year>=+n)return!0}}}function Se(t){return X.find(function(e){if(+t===e.id)return e})}function we(){var e;Ya.share2("achive-share",{content:{url:"https://ugadai-film.ru",title:"Я угадал "+(e=U,"".concat(e," ").concat(["кадр","кадра","кадров"][4<e%100&&e%100<20?2:[2,0,1,1,1,2][e%10<5?e%10:5]]))+"!"}})}function ke(){return(ke=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,a,o,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_e(),n={},r=[],I.classList.add("_hidden"),O.classList.add("_hidden"),J.length==f.value||J.length===t.length)return I.innerHTML="",J=[],fe(l),document.querySelector(".fireworks-container").innerHTML="",window.fireworks=new Fireworks(document.querySelector(".fireworks-container"),{hue:{min:0,max:345},delay:{min:30,max:45},rocketsPoint:50,speed:1,acceleration:1.2,friction:.96,gravity:1,particles:300,trace:2,explosion:6,autoresize:!0,brightness:{min:50,max:80,decay:{min:.015,max:.03}},boundaries:{visible:!1}}),window.fireworks.start(),ye(),we(),e.abrupt("return");e.next=13;break;case 13:if(!ee.directAnswer){for(I.classList.remove("_hidden");r.length<1;)n=t[Ae(t.length)],ge(n.genres,G)&&!1===J.includes(n.id)&&r.push(n);for(;r.length<4;)a=t[Ae(t.length)],o=a.genres,!r.includes(a)&&a!==n&&ge(o,n.genres)&&r.push(a);r=function(e){var t,n,r=e.length;for(;0!==r;)n=Math.floor(Math.random()*r),t=e[--r],e[r]=e[n],e[n]=t;return e}(r=r.map(function(e){return{id:e.id,name:ee.originalName?e.nameOrig:e.name,year:e.year}}))}if(ee.directAnswer)for(O.classList.remove("_hidden"),c=!1;!c;)n=t[Ae(t.length)],J.includes(n.id)||(c=!0,function(){var t=[],n=_e();W.classList.add("button-disabled"),R.addEventListener("keyup",function(e){t=[],D.innerHTML="","Backspace"!==e.key&&"Delete"!==e.key||W.classList.add("button-disabled");e=n.map(function(e){return{id:e.id,name:ee.originalName?e.nameOrig:e.name,year:e.year}});R.value.length&&(t=e.sort(function(e,t){return e.name.localeCompare(t.name)}).filter(function(e){return e.name.toLowerCase().includes(R.value.toLowerCase())}).slice(0,3)).forEach(function(e){var t,n,e=(t=e,(n=document.createElement("div")).classList.add("playground-answer-suggestion"),n.setAttribute("data-name",t.name),n.innerText=t.name+" ("+t.year+")",n.addEventListener("click",function(){R.value=n.getAttribute("data-name"),z=t.id,D.innerHTML="",W.classList.remove("button-disabled"),R.classList.remove("playground-answer-input-opened")}),n);D.appendChild(e)}),R.classList[t.length?"add":"remove"]("playground-answer-input-opened")})}());return i.classList.add("playground__loading"),e.next=18,axios("/php/getFrame.php?id="+n.id).then(function(e){return{photo:e.data,answer:n.id,answers:r}}).catch(function(e){console.log(e)});case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function qe(){window.fireworks&&window.fireworks.stop()}function Ae(e){return Math.floor(Math.random()*e)}$.getJSON("/dest/json/facts.json?"+(new Date).getMilliseconds(),function(e){Z=e}),function(){return oe.apply(this,arguments)}().then(function(e){X=e,void 0===window.HTMLDialogElement&&document.querySelectorAll("dialog").forEach(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve("".concat("https://esm.run/dialog-polyfill")).then(function(e){return _interopRequireWildcard(require(e))});case 2:n=e.sent,n.default.registerDialog(t);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()),j.innerHTML=X.length,_toConsumableArray(q).map(function(e){e.addEventListener("click",function(){se(),fe(n)})}),_toConsumableArray(A).map(function(e){e.addEventListener("click",function(){var n,r;G.length?(ue(),fe(a),function(e){h.innerHTML="",m.innerHTML="Все",Y=[{value:"all",label:"Все"}],ue();var t=le("Все","all",!0);h.appendChild(t),e.forEach(function(e,t){var n=function(e){if(e<1990)return{value:"before1990",label:"до 1990"};if(1990<=e&&e<2e3)return{value:"1990-2000",label:"с 1990 до 2000"};if(2e3<=e&&e<2010)return{value:"2000-2010",label:"с 2000 до 2010"};if(2010<=e&&e<2020)return{value:"2010-2020",label:"с 2010 до 2020"};if(2020<=e)return{value:"after2020",label:"с 2020"}}(t),t=n.value,n=n.label;h.querySelector('.segment-year[data-value="'+t+'"]')||(t=le(n,t),h.appendChild(t))}),function(){var e=h.querySelectorAll('.segment-year:not([data-value="all"])'),n=document.querySelector('.segment-year[data-value="all"]');_toConsumableArray(e).forEach(function(t){t.addEventListener("click",function(){var e={value:t.getAttribute("data-value"),label:t.getAttribute("data-label")};ie(n,{value:"all",label:"Все"}),t.classList.contains("segment-year-selected")?(ie(t,e),F.length||ce(n,{value:"all",label:"Все"})):ce(t,e)})}),n.addEventListener("click",function(){_toConsumableArray(e).forEach(function(e){var t={value:e.getAttribute("data-value"),label:e.getAttribute("data-label")};ie(e,t)}),ce(n,{value:"all",label:"Все"})})}()}((r=[],n=(n=G).join("|"),X.forEach(function(e){var t=e.year;t.includes(" - ")&&(t=t.split(" - ")[0]),r[t]||(r[t]=[]),r[t]&&n.includes(e.genres[0])?r[t].push(e.name):r[t].length||delete r[t]}),r))):alert("Выберите категорию")})}),_toConsumableArray(E).map(function(e){e.addEventListener("click",function(){fe(r)})}),_toConsumableArray(T).map(function(e){e.addEventListener("click",function(){fe(t)})}),_toConsumableArray(C).map(function(e){e.addEventListener("click",function(){fe(o)})}),_toConsumableArray(H).map(function(e){e.addEventListener("click",function(){ve(z,e)})}),_toConsumableArray(y).map(function(e){e.addEventListener("click",function(){p.close()})}),v.addEventListener("click",function(){p.close(),Y=F,ue(),m.innerHTML=Y.map(function(e){return e.label}).join(", ")}),m.addEventListener("click",function(){p.showModal(),F=Y,_toConsumableArray(document.querySelectorAll(".segment-year")).forEach(function(e){e.classList.remove("segment-year-selected")}),Y.forEach(function(e){document.querySelector('.segment-year[data-value="'+e.value+'"]').classList.add("segment-year-selected")})}),_toConsumableArray(M).map(function(e){e.addEventListener("click",function(){K=U=0,fe(i),_.innerHTML=0,P=Q=0,J=[],N={},I.innerHTML="",R.innerHTML="",D.innerHTML="",w.innerHTML="",k.style.display="block",S.style.display="none",L.classList.remove("playground-img__grayscale"),ee.blackwhite&&L.classList.add("playground-img__grayscale"),be()})}),_toConsumableArray(x).map(function(e){e.addEventListener("click",function(){be()})}),_toConsumableArray(s).forEach(function(t){t.addEventListener("click",function(){t.querySelector("input").getAttribute("data-is-parent")?t.parentElement.querySelectorAll(".checkbox__body").forEach(function(e){de(e,t)}):de(t)})}),_toConsumableArray(d).forEach(function(n){n.addEventListener("click",function(){var e=n.querySelector("input"),t=e.value;e.checked=!e.checked,n.classList[e.checked?"add":"remove"]("checkbox__checked"),"time"==t&&(ee.needTimer=e.checked),"onelife"==t&&(ee.onelife=e.checked),"blackwhite"==t&&(ee.blackwhite=e.checked),"facts"==t&&(ee.facts=e.checked),"directanswer"==t&&(ee.directAnswer=e.checked),"originalname"==t&&(ee.originalName=e.checked)})})})});